var container;window.addEventListener("beforeunload",(function(t){t.preventDefault(),t.returnValue=""}));var search_array,search_period,current_sort="alpha",is_search=!1;class Student{constructor(t,e,n){this.first=t,this.last=e,this.points=parseInt(n),this.init_points=parseInt(n),this.alpha_pos=0}}function readFile(t){var e=t.target.files[0];if(e){var n=new FileReader;return n.onload=function(t){var e=t.target.result,n=$.csv.toObjects(e),r=new Map;for(var a in n){var s=n[a];if(r.has(s.period))r.get(s.period).push(new Student(s.first,s.last,s.points));else r.set(s.period,new Array(new Student(s.first,s.last,s.points)))}container=new Map([...r.entries()].sort()),renderFirst(),switchContainers()},n.readAsText(e)}}function readText(){var t=$.csv.toObjects(document.getElementById("textarea").value),e=new Map;for(var n in t){var r=t[n];if(e.has(r.period))e.get(r.period).push(new Student(r.first,r.last,r.points));else e.set(r.period,new Array(new Student(r.first,r.last,r.points)))}container=new Map([...e.entries()].sort()),renderFirst(),switchContainers()}function switchContainers(){document.getElementById("first-container").hidden=!0,document.getElementById("second-container").hidden=!1}function sortAlpha(){for(var[,t]of container)for(var e in t.sort((t,e)=>t.last.toUpperCase()==e.last.toUpperCase()?t.first.toUpperCase()<e.first.toUpperCase()?-1:1:t.last.toUpperCase()<e.last.toUpperCase()?-1:1),t)t[e].alpha_pos=e}function sortAlphaTab(t){(is_search?search_array:container.get(t.toString())).sort((t,e)=>t.last.toUpperCase()==e.last.toUpperCase()?t.first.toUpperCase()<e.first.toUpperCase()?-1:1:t.last.toUpperCase()<e.last.toUpperCase()?-1:1),current_sort="alpha",rerender()}function sortDescendTab(t){(is_search?search_array:container.get(t.toString())).sort((t,e)=>e.points-e.init_points-(t.points-t.init_points)==0?t.last.toUpperCase()==e.last.toUpperCase()?t.first.toUpperCase()<e.first.toUpperCase()?-1:1:t.last.toUpperCase()<e.last.toUpperCase()?-1:1:e.points-e.init_points-(t.points-t.init_points)),current_sort="descend",rerender()}function sortAscendTab(t){(is_search?search_array:container.get(t.toString())).sort((t,e)=>t.points-e.points==0?t.last.toUpperCase()==e.last.toUpperCase()?t.first.toUpperCase()<e.first.toUpperCase()?-1:1:t.last.toUpperCase()<e.last.toUpperCase()?-1:1:t.points-e.points),current_sort="ascend",rerender()}function rerender(){let t=0;if(is_search)for(let e in search_array){let n=search_array[e],r=document.getElementById(`${n.first}-${n.last}-${search_period}-row`);0==t?(t=-1,r.style.transform=`translateY(${r.offsetHeight*(e-n.alpha_pos)}px)`):-1==t?(t=r.offsetHeight,r.style.transform=`translateY(${t*(e-n.alpha_pos)}px)`):r.style.transform=`translateY(${t*(e-n.alpha_pos)}px)`,r.style.zIndex=""+(search_array.size-e)}else for(let[e,n]of container)for(let r in n){let a=n[r],s=document.getElementById(`${a.first}-${a.last}-${e}-row`);0==t?(t=-1,s.style.transform=`translateY(${s.offsetHeight*(r-a.alpha_pos)}px)`):-1==t?(t=s.offsetHeight,s.style.transform=`translateY(${t*(r-a.alpha_pos)}px)`):s.style.transform=`translateY(${t*(r-a.alpha_pos)}px)`,s.style.zIndex=""+(n.size-r)}}function rerenderAfterTabSearch(t){is_search=!1,$("#list-group-"+t).empty();var e=container.get(t.toString());for(const n of e){let e,r;$("#list-group-"+t).append(`\n            <li id="${n.first}-${n.last}-${t}-row"class="list-group-item d-flex">\n                <span class="flex-grow-1" style="text-align: center;">${n.first} ${n.last}</span>\n                <span id="${n.first}-${n.last}-${t}-change" style="text-align: center; width: 75px;">+0</span>\n                <input id="${n.first}-${n.last}-${t}-input" type="number" value="${n.points}" placeholder="0" min="0" step="1" style="text-align: center;width: 75px;" onclick="updateScore(event)">\n            </li>\n        `),n.points-n.init_points>0?(e="green",r="+"+(n.points-n.init_points)):n.points-n.init_points<0?(e="red",r=""+(n.points-n.init_points)):(e="grey",r="+0"),document.getElementById(`${n.first}-${n.last}-${t}-change`).innerHTML=r,document.getElementById(`${n.first}-${n.last}-${t}-change`).style.color=e}}function rerenderDuringTabSearch(t,e){if(0!=e.length){$("#list-group-"+t).empty(),search_array=[],search_period=t;var n=container.get(t.toString());for(const r of n)if(r.first.toUpperCase().includes(e.toUpperCase())||r.last.toUpperCase().includes(e.toUpperCase())){let e,n,a=Object.assign({},r);a.alpha_pos=search_array.length,search_array.push(a),$("#list-group-"+t).append(`\n                <li id="${r.first}-${r.last}-${t}-row" class="list-group-item d-flex">\n                    <span class="flex-grow-1" style="text-align: center;">${r.first} ${r.last}</span>\n                    <span id="${r.first}-${r.last}-${t}-change" style="text-align: center; width: 75px;">+0</span>\n                    <input id="${r.first}-${r.last}-${t}-input" type="number" value="${r.points}" placeholder="0" min="0" step="1" style="text-align: center;width: 75px;" onclick="updateScore(event)">\n                </li>\n            `),r.points-r.init_points>0?(e="green",n="+"+(r.points-r.init_points)):r.points-r.init_points<0?(e="red",n=""+(r.points-r.init_points)):(e="grey",n="+0"),document.getElementById(`${r.first}-${r.last}-${t}-change`).innerHTML=n,document.getElementById(`${r.first}-${r.last}-${t}-change`).style.color=e}is_search=!0}else rerenderAfterTabSearch(t)}function adjustSearch(t){is_search=!1;let e=document.getElementById(t+"-searchbar").innerText;0!=e&&rerenderDuringTabSearch(t,e)}function updateScore(t){let e,[n,r,a]=t.target.id.split("-");switch(is_search?(e=search_array.find(t=>t.first==n&&t.last==r),container.get(a).find(t=>t.first==n&&t.last==r).points=parseInt(t.target.value)):e=container.get(a).find(t=>t.first==n&&t.last==r),e.points=parseInt(t.target.value),e.points-e.init_points>0?(document.getElementById(`${e.first}-${e.last}-${a}-change`).innerHTML="+"+(e.points-e.init_points),document.getElementById(`${e.first}-${e.last}-${a}-change`).style.color="green"):e.points-e.init_points<0?(document.getElementById(`${e.first}-${e.last}-${a}-change`).innerHTML=""+(e.points-e.init_points),document.getElementById(`${e.first}-${e.last}-${a}-change`).style.color="red"):(document.getElementById(`${e.first}-${e.last}-${a}-change`).innerHTML="+0",document.getElementById(`${e.first}-${e.last}-${a}-change`).style.color="grey"),current_sort){case"alpha":sortAlphaTab(a);break;case"descend":sortDescendTab(a);break;case"ascend":sortAscendTab(a)}}function renderFirst(){sortAlpha();var t=!0;for(var[e,n]of container){t?($("#tablist").append(`\n                <li class="nav-item" role="presentation">\n                    <a onclick="adjustSearch('${e}')" class="nav-link active" role="tab" data-toggle="tab" href="#tab-${e}">Period ${e}</a>\n                </li>\n            `),$("#tab-content").append(`\n                <div class="tab-pane fade show active" role="tabpanel" id="tab-${e}">\n                    <input id="${e}-searchbar" oninput="rerenderDuringTabSearch('${e}', event.target.value)" type="search" class="form-control-lg" style="width: 100%;color: rgb(45,46,55);border: 1px solid rgb(67,67,67);text-align: center; height: 5vh;" placeholder="Search Names" />\n                    <div class="btn-group btn-group-toggle d-flex" data-toggle="buttons" style="height: 5vh">\n                        <label class="btn btn-outline-primary active" for="btnradio1-${e}" style="border-radius: 0;" onclick=sortAlphaTab('${e}')>\n                            <input type="radio" name="btnradio-${e}" checked id="btnradio1-${e}">\n                            A -> Z\n                        </label>\n                        <label class="btn btn-outline-primary" for="btnradio2-${e}" style="border-radius: 0;" onclick=sortDescendTab('${e}')>\n                            <input type="radio" class="btn-check" name="btnradio-${e}" id="btnradio2-${e}">\n                            +4, ..., -5\n                        </label>\n                        <label class="btn btn-outline-primary" for="btnradio3-${e}" style="border-radius: 0;" onclick=sortAscendTab('${e}')>\n                            <input type="radio" name="btnradio-${e}" id="btnradio3-${e}">\n                            1, 2, ...\n                        </label>\n                    </div>\n                    <ul class="list-group text-monospace border rounded-0" id="list-group-${e}" style="height: 60vh;overflow-y: auto;">\n                        \n                    </ul>\n                </div>\n            `),t=!1):($("#tablist").append(`\n                <li class="nav-item" role="presentation">\n                    <a onclick="adjustSearch('${e}')" class="nav-link" role="tab" data-toggle="tab" href="#tab-${e}">Period ${e}</a>\n                </li>\n            `),$("#tab-content").append(`\n            <div class="tab-pane fade" role="tabpanel" id="tab-${e}">\n                <input id="${e}-searchbar" oninput="rerenderDuringTabSearch('${e}', event.target.value)" type="search" class="form-control-lg" style="width: 100%;color: rgb(45,46,55);border: 1px solid rgb(67,67,67);text-align: center; height: 5vh;" placeholder="Search Names" />\n                <div class="btn-group btn-group-toggle d-flex" data-toggle="buttons" style="height: 5vh">\n                    <label class="btn btn-outline-primary active" for="btnradio1-${e}" style="border-radius: 0;" onclick=sortAlphaTab('${e}')>\n                        <input type="radio" name="btnradio-${e}" checked id="btnradio1-${e}">\n                        A -> Z\n                    </label>\n                    <label class="btn btn-outline-primary" for="btnradio2-${e}" style="border-radius: 0;" onclick=sortDescendTab('${e}')>\n                        <input type="radio" class="btn-check" name="btnradio-${e}" id="btnradio2-${e}">\n                        +4, ..., -5\n                    </label>\n                    <label class="btn btn-outline-primary" for="btnradio3-${e}" style="border-radius: 0;" onclick=sortAscendTab('${e}')>\n                        <input type="radio" name="btnradio-${e}" id="btnradio3-${e}">\n                        1, 2, ...\n                    </label>\n                </div>\n                <ul class="list-group text-monospace border rounded-0" id="list-group-${e}" style="height: 60vh;overflow-y: auto;">\n                    \n                </ul>\n            </div>\n            `));for(const t of n)$("#list-group-"+e).append(`\n                <li id="${t.first}-${t.last}-${e}-row"class="list-group-item d-flex">\n                    <span class="flex-grow-1" style="text-align: center;">${t.first} ${t.last}</span>\n                    <span id="${t.first}-${t.last}-${e}-change" style="text-align: center; width: 75px; color: grey;">+0</span>\n                    <input id="${t.first}-${t.last}-${e}-input" type="number" value="${t.points}" placeholder="0" min="0" step="1" style="text-align: center;width: 75px;" onclick="updateScore(event)">\n                </li>\n            `)}}function writeModal(){var t=[];for(var[e,n]of container)for(var r in n){var a=new Object(null);a.period=e,a.first=n[r].first,a.last=n[r].last,a.points=n[r].points,t.push(a)}document.getElementById("csv-out").innerText="\n"+$.csv.fromObjects(t)}function downloadModal(){var t=document.getElementById("csv-out").innerText.replace(/^\n/,""),e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download","points.csv"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}document.getElementById("file-input-clickable").addEventListener("change",readFile,!1),document.getElementById("file-input").addEventListener("click",()=>{document.getElementById("file-input-clickable").click()}),document.getElementById("text-input").addEventListener("click",()=>{readText()}),document.getElementById("open-export-modal").addEventListener("click",()=>{writeModal()}),document.getElementById("download-csv").addEventListener("click",()=>{downloadModal()});